<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LADODO - Casino Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Righteous&family=Roboto:wght@400;700&display=swap');

        body { 
            background: radial-gradient(circle at center, #2e1065 0%, #020617 100%);
            color: white; 
            user-select: none; 
            font-family: 'Roboto', sans-serif; 
            overflow: hidden;
            touch-action: manipulation;
        }
        
        h1, .casino-font { font-family: 'Righteous', cursive; }

        /* Animations */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); }
        }

        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .shake-element { animation: shake 0.5s; animation-iteration-count: infinite; }
        .shake-screen { animation: shake 0.5s; animation-iteration-count: 1; }
        
        .active-player {
            border: 2px solid #eab308;
            background: rgba(234, 179, 8, 0.1);
            animation: pulse-gold 2s infinite;
        }

        .dice-3d {
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.5), 2px 2px 5px rgba(255,255,255,0.2);
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .neon-text {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px #eab308, 0 0 30px #eab308;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // --- SOUND ENGINE (Synthesized) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        const playSound = (type) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.linearRampToValueAtTime(800, now + 0.1);
                osc.frequency.linearRampToValueAtTime(1200, now + 0.3);
                gain.gain.setValueAtTime(0.1, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.3);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'shake') {
                // Noise buffer for shake
                const bufferSize = audioCtx.sampleRate * 0.2;
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                
                const noise = audioCtx.createBufferSource();
                noise.buffer = buffer;
                const noiseGain = audioCtx.createGain();
                noiseGain.gain.setValueAtTime(0.1, now);
                noiseGain.gain.linearRampToValueAtTime(0, now + 0.2);
                noise.connect(noiseGain);
                noiseGain.connect(audioCtx.destination);
                noise.start(now);
            }
        };

        // --- FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyCUvDUDrj1MofAFRYeDrGP7OoIz0qX0iW8",
            authDomain: "dudogame-44b81.firebaseapp.com",
            databaseURL: "https://dudogame-44b81-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "dudogame-44b81",
            storageBucket: "dudogame-44b81.firebasestorage.app",
            messagingSenderId: "681233339238",
            appId: "1:681233339238:web:c8ed065e83227b6bd22ea7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const { useState, useEffect, useRef, useMemo } = React;

        // --- ICONS & ASSETS ---
        const AVATARS = ['ðŸ˜Ž', 'ðŸ¤ ', 'ðŸ‘½', 'ðŸ‘»', 'ðŸ¤–', 'ðŸ¦Š', 'ðŸ¦', 'ðŸ¦„', 'ðŸ¸', 'ðŸµ'];
        
        const DiceIcon = ({ value, size = 50, color = 'white' }) => {
            const dots = {
                1: [[50, 50]], 2: [[25, 25], [75, 75]], 3: [[25, 25], [50, 50], [75, 75]],
                4: [[25, 25], [25, 75], [75, 25], [75, 75]], 
                5: [[25, 25], [25, 75], [50, 50], [75, 25], [75, 75]],
                6: [[25, 25], [25, 50], [25, 75], [75, 25], [75, 50], [75, 75]]
            };
            return React.createElement('svg', { width: size, height: size, viewBox: '0 0 100 100', className: 'dice-3d drop-shadow-md' },
                React.createElement('rect', { x: 5, y: 5, width: 90, height: 90, rx: 15, fill: value === 1 ? '#ef4444' : '#1e293b', stroke: 'rgba(255,255,255,0.5)', strokeWidth: 2 }),
                dots[value]?.map(([cx, cy], i) => React.createElement('circle', { key: i, cx, cy, r: 8, fill: 'white' }))
            );
        };

        // --- MAIN APPLICATION ---
        const App = () => {
            // -- State --
            const [player, setPlayer] = useState(() => {
                const saved = JSON.parse(sessionStorage.getItem('ladodo_player') || '{}');
                return {
                    id: saved.id || Math.random().toString(36).substring(2, 9),
                    name: saved.name || 'Player',
                    avatar: saved.avatar || AVATARS[Math.floor(Math.random() * AVATARS.length)]
                };
            });
            
            const [gameState, setGameState] = useState(null);
            const [roomId, setRoomId] = useState('');
            const [localBid, setLocalBid] = useState(null); // { quantity, value }
            const [cupOpen, setCupOpen] = useState(false);
            const [shaking, setShaking] = useState(false);
            const [screenShake, setScreenShake] = useState(false);
            const [notification, setNotification] = useState(null); // { text, type }
            const [isEditMode, setIsEditMode] = useState(false); // Edit name/avatar

            // -- Refs --
            const audioRef = useRef(null);

            // -- Effects --
            useEffect(() => {
                // Save player info
                sessionStorage.setItem('ladodo_player', JSON.stringify(player));
            }, [player]);

            // Auto-join from URL
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const code = params.get('room');
                if (code) {
                    setRoomId(code);
                    joinRoom(code);
                }
            }, []);

            // Game Loop Listener
            useEffect(() => {
                if (!roomId || !gameState) return;
                const roomRef = db.ref(`rooms/${roomId}`);
                
                const handleUpdate = (snap) => {
                    const val = snap.val();
                    if (val) {
                        // Check for Earthquakes (Dudo called)
                        if (val.phase === 'REVEALED' && gameState.phase !== 'REVEALED') {
                            playSound('error'); // Dudo sound
                            setScreenShake(true);
                            setTimeout(() => setScreenShake(false), 500);
                            
                            // Auto restart logic (Host only needs to trigger, but we can make anyone trigger safely via transaction)
                            if (val.hostId === player.id) {
                                setTimeout(() => {
                                    startNextRound(val);
                                }, 5000); // 5 Seconds delay
                            }
                        }

                        // Check for Winner
                        if (val.phase === 'WON' && gameState.phase !== 'WON') {
                            playSound('win');
                            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                        }

                        setGameState(val);

                        // Reset local bid when turn changes
                        if (val.currentBid && val.phase === 'PLAYING') {
                            // Default to current bid (user must increase)
                            setLocalBid(val.currentBid); 
                        } else {
                            // New round defaults
                            setLocalBid({ quantity: 1, value: 2 });
                        }
                    }
                };

                roomRef.on('value', handleUpdate);
                return () => roomRef.off();
            }, [roomId, gameState?.phase]);

            // -- Logic --

            const createRoom = () => {
                const code = Math.floor(1000 + Math.random() * 9000).toString();
                const initial = {
                    roomId: code,
                    hostId: player.id,
                    phase: 'LOBBY',
                    turnIndex: 0,
                    playerSequence: [player.id],
                    players: {
                        [player.id]: { ...player, diceCount: 5, dice: [] }
                    }
                };
                db.ref(`rooms/${code}`).set(initial);
                setRoomId(code);
                setGameState(initial);
                playSound('click');
            };

            const joinRoom = (code = roomId) => {
                if (code.length !== 4) return;
                db.ref(`rooms/${code}`).transaction((room) => {
                    if (room) {
                        if (!room.players[player.id]) {
                            // Late joiner logic: Get min dice count
                            const existingPlayers = Object.values(room.players);
                            const minDice = room.phase === 'PLAYING' 
                                ? Math.min(...existingPlayers.map(p => p.diceCount)) 
                                : 5;

                            room.players[player.id] = { ...player, diceCount: minDice, dice: [] };
                            room.playerSequence.push(player.id);
                        }
                    }
                    return room;
                }, (error, committed, snapshot) => {
                    if (committed) {
                        setRoomId(code);
                        setGameState(snapshot.val());
                        playSound('click');
                    } else {
                        alert("Room not found!");
                    }
                });
            };

            const shareRoom = () => {
                const url = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
                navigator.clipboard.writeText(url);
                setNotification("Link Copied!");
                setTimeout(() => setNotification(null), 2000);
            };

            const rollDice = (count) => Array.from({ length: count }, () => Math.floor(Math.random() * 6) + 1);

            const startGame = () => {
                const updates = {};
                const newPlayers = { ...gameState.players };
                
                // Roll for everyone
                Object.keys(newPlayers).forEach(pid => {
                    newPlayers[pid].dice = rollDice(newPlayers[pid].diceCount);
                });

                db.ref(`rooms/${roomId}`).update({
                    phase: 'PLAYING',
                    players: newPlayers,
                    currentBid: null,
                    turnIndex: 0,
                    lastAction: null
                });
                
                // Shake effect for everyone handled by phase change ideally, but we simulate locally
                setShaking(true);
                playSound('shake');
                setTimeout(() => setShaking(false), 1000);
            };

            const startNextRound = (currentRoomState) => {
                const newPlayers = { ...currentRoomState.players };
                const playersLeft = currentRoomState.playerSequence.filter(pid => newPlayers[pid].diceCount > 0);

                if (playersLeft.length === 1) {
                    db.ref(`rooms/${roomId}`).update({ phase: 'WON', winnerId: playersLeft[0] });
                    return;
                }

                // Reroll
                Object.keys(newPlayers).forEach(pid => {
                    if (newPlayers[pid].diceCount > 0) {
                        newPlayers[pid].dice = rollDice(newPlayers[pid].diceCount);
                    } else {
                        newPlayers[pid].dice = [];
                    }
                });

                // Rotate start player
                let nextStart = (currentRoomState.turnIndex + 1) % playersLeft.length; 

                db.ref(`rooms/${roomId}`).update({
                    phase: 'PLAYING',
                    players: newPlayers,
                    playerSequence: playersLeft, // Remove dead players from sequence
                    turnIndex: 0, // Simplified: Winner/Loser starts or just rotate. Let's reset to 0 of new sequence
                    currentBid: null,
                    lastAction: null
                });
            };

            const placeBid = () => {
                // Validation
                const current = gameState.currentBid;
                let valid = true;
                if (current) {
                     if (localBid.quantity < current.quantity) valid = false;
                     if (localBid.quantity === current.quantity && localBid.value <= current.value) valid = false;
                }

                if (!valid) {
                    playSound('error');
                    setNotification("Bid must be HIGHER!");
                    setTimeout(() => setNotification(null), 2000);
                    return;
                }

                const nextTurn = (gameState.turnIndex + 1) % gameState.playerSequence.length;
                db.ref(`rooms/${roomId}`).update({
                    currentBid: { ...localBid, playerId: player.id },
                    turnIndex: nextTurn,
                    lastAction: { type: 'BID', playerId: player.id, bid: localBid }
                });
                playSound('click');
            };

            const callDudo = () => {
                const bid = gameState.currentBid;
                const allDice = Object.values(gameState.players).flatMap(p => p.dice);
                // Wildcard logic: Aces (1) count unless bid is on Aces
                const count = allDice.filter(d => d === bid.value || (bid.value !== 1 && d === 1)).length;
                
                const success = count < bid.quantity; // Bidder lied!
                const loserId = success ? bid.playerId : player.id;
                
                const newPlayers = { ...gameState.players };
                newPlayers[loserId].diceCount = Math.max(0, newPlayers[loserId].diceCount - 1);

                db.ref(`rooms/${roomId}`).update({
                    phase: 'REVEALED',
                    players: newPlayers,
                    lastAction: { 
                        type: 'DUDO', 
                        caller: player.id, 
                        bidder: bid.playerId, 
                        success, 
                        loserId,
                        actualCount: count,
                        bidWas: bid
                    }
                });
            };

            // -- Render Helpers --
            const me = gameState?.players?.[player.id];
            const isMyTurn = gameState?.phase === 'PLAYING' && gameState.playerSequence[gameState.turnIndex] === player.id;

            // --- RENDER ---
            
            // 1. EDIT PROFILE SCREEN (Overlay)
            if (isEditMode) {
                 return React.createElement('div', { className: 'h-screen flex flex-col items-center justify-center space-y-6 p-4' },
                    React.createElement('h2', { className: 'text-3xl casino-font text-yellow-400' }, 'EDIT PROFILE'),
                    React.createElement('input', { 
                        value: player.name, 
                        onChange: e => setPlayer({...player, name: e.target.value.substring(0, 12)}),
                        className: 'bg-slate-800 border-2 border-yellow-500 rounded-xl p-4 text-center text-2xl w-full max-w-xs',
                        placeholder: 'Your Name'
                    }),
                    React.createElement('div', { className: 'grid grid-cols-5 gap-2' },
                        AVATARS.map(av => React.createElement('button', {
                            key: av,
                            onClick: () => setPlayer({...player, avatar: av}),
                            className: `text-3xl p-2 rounded-lg ${player.avatar === av ? 'bg-yellow-500' : 'bg-slate-700'}`
                        }, av))
                    ),
                    React.createElement('button', { onClick: () => setIsEditMode(false), className: 'bg-green-600 px-8 py-3 rounded-full font-bold text-xl' }, 'SAVE')
                 );
            }

            // 2. LOBBY SCREEN
            if (!gameState) {
                return React.createElement('div', { className: 'h-screen flex flex-col items-center justify-center p-6 space-y-8 text-center' },
                    React.createElement('div', { className: 'animate-pulse' },
                        React.createElement('h1', { className: 'text-7xl neon-text text-yellow-400 mb-2' }, 'LADODO'),
                        React.createElement('div', { className: 'text-xl tracking-widest text-purple-300' }, 'CASINO EDITION')
                    ),
                    
                    React.createElement('div', { 
                        className: 'glass-panel p-4 rounded-2xl flex items-center space-x-4 cursor-pointer',
                        onClick: () => setIsEditMode(true)
                    },
                        React.createElement('span', { className: 'text-4xl' }, player.avatar),
                        React.createElement('div', { className: 'text-left' },
                            React.createElement('div', { className: 'text-xs text-slate-400' }, 'PLAYING AS'),
                            React.createElement('div', { className: 'font-bold text-xl' }, player.name)
                        ),
                        React.createElement('span', { className: 'text-slate-400' }, 'âœŽ')
                    ),

                    React.createElement('button', { onClick: createRoom, className: 'w-64 bg-gradient-to-r from-yellow-500 to-amber-600 p-4 rounded-full text-2xl font-bold shadow-lg transform active:scale-95 transition' }, 'CREATE ROOM'),
                    
                    React.createElement('div', { className: 'flex space-x-2 w-64' },
                        React.createElement('input', { 
                            value: roomId, 
                            onChange: e => setRoomId(e.target.value.substring(0,4)),
                            className: 'flex-1 bg-slate-800 text-center text-xl rounded-l-full border-y border-l border-slate-600',
                            placeholder: 'CODE' 
                        }),
                        React.createElement('button', { onClick: () => joinRoom(), className: 'bg-green-600 px-6 rounded-r-full font-bold' }, 'JOIN')
                    )
                );
            }

            // 3. GAME SCREEN
            return React.createElement('div', { className: `h-screen flex flex-col relative ${screenShake ? 'shake-screen' : ''}` },
                // Header
                React.createElement('div', { className: 'flex justify-between items-center p-4 bg-black/30 backdrop-blur' },
                    React.createElement('div', { className: 'flex flex-col' },
                        React.createElement('span', { className: 'text-yellow-500 font-mono text-xs' }, 'ROOM CODE'),
                        React.createElement('div', { className: 'text-2xl font-bold font-mono tracking-widest' }, roomId)
                    ),
                    React.createElement('button', { onClick: shareRoom, className: 'bg-blue-600/50 p-2 rounded-full text-sm' }, 'ðŸ”— SHARE'),
                ),
                
                // Notification Overlay
                notification && React.createElement('div', { className: 'absolute top-20 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-2 rounded-full font-bold z-50 shadow-xl animate-bounce' }, notification),

                // Main Table Area
                React.createElement('div', { className: 'flex-1 relative flex flex-col items-center justify-center perspective-1000' },
                    
                    // Opponents (Top)
                    React.createElement('div', { className: 'absolute top-4 w-full flex justify-center space-x-3 px-2 overflow-x-auto' },
                        gameState.playerSequence.filter(pid => pid !== player.id).map(pid => {
                            const p = gameState.players[pid];
                            const isActive = gameState.phase === 'PLAYING' && gameState.playerSequence[gameState.turnIndex] === pid;
                            return React.createElement('div', { key: pid, className: `flex flex-col items-center p-2 rounded-xl transition-all ${isActive ? 'active-player scale-110' : 'opacity-60 grayscale'}` },
                                React.createElement('div', { className: 'text-2xl' }, p.avatar),
                                React.createElement('div', { className: 'text-[10px] font-bold truncate max-w-[60px]' }, p.name),
                                React.createElement('div', { className: 'flex space-x-0.5 mt-1' },
                                    Array.from({ length: p.diceCount }).map((_, i) => React.createElement('div', { key: i, className: 'w-1.5 h-1.5 bg-yellow-400 rounded-full' }))
                                )
                            );
                        })
                    ),

                    // Lobby Start Button
                    gameState.phase === 'LOBBY' && React.createElement('div', { className: 'text-center space-y-4' },
                        React.createElement('div', { className: 'text-4xl text-slate-300 font-light' }, 'WAITING FOR PLAYERS...'),
                        React.createElement('div', { className: 'text-xl' }, `${gameState.playerSequence.length} JOINED`),
                        gameState.hostId === player.id && React.createElement('button', { onClick: startGame, className: 'bg-green-500 text-black px-8 py-4 rounded-full text-2xl font-bold shadow-[0_0_20px_rgba(34,197,94,0.6)] animate-pulse' }, 'START GAME')
                    ),

                    // The Bid (Center)
                    gameState.phase === 'PLAYING' && gameState.currentBid && React.createElement('div', { className: 'flex flex-col items-center bg-black/40 p-6 rounded-3xl border border-yellow-500/30' },
                        React.createElement('div', { className: 'text-xs text-yellow-500 uppercase tracking-widest mb-2' }, 'CURRENT BID'),
                        React.createElement('div', { className: 'flex items-center space-x-4' },
                            React.createElement('span', { className: 'text-7xl font-bold text-white' }, gameState.currentBid.quantity),
                            React.createElement('span', { className: 'text-4xl text-slate-400' }, 'x'),
                            React.createElement(DiceIcon, { value: gameState.currentBid.value, size: 70 })
                        ),
                        React.createElement('div', { className: 'mt-2 text-sm text-slate-400' }, `By ${gameState.players[gameState.currentBid.playerId]?.name}`)
                    ),

                    // Revelation / End Round (Center)
                    gameState.phase === 'REVEALED' && gameState.lastAction && React.createElement('div', { className: 'text-center bg-black/80 p-6 rounded-3xl z-20 border-2 border-red-500 w-11/12' },
                        React.createElement('h2', { className: 'text-3xl font-black text-red-500 mb-4' }, 'DUDO CALLED!'),
                        React.createElement('div', { className: 'text-xl mb-4' }, 
                            React.createElement('span', { className: 'text-yellow-400' }, gameState.players[gameState.lastAction.caller].name),
                            ' called liar on ',
                            React.createElement('span', { className: 'text-blue-400' }, gameState.players[gameState.lastAction.bidder].name)
                        ),
                        React.createElement('div', { className: 'flex flex-wrap justify-center gap-2 mb-6' },
                            Object.entries(gameState.players).map(([pid, p]) => 
                                p.dice.map((d, i) => React.createElement('div', { key: pid+i, className: gameState.lastAction.bidWas.value === d || d === 1 ? 'opacity-100 scale-110' : 'opacity-40 grayscale' }, 
                                    React.createElement(DiceIcon, { value: d, size: 35 })
                                ))
                            )
                        ),
                        React.createElement('div', { className: 'text-2xl font-bold' }, 
                            `Total ${gameState.lastAction.bidWas.value}'s (and Aces): `,
                            React.createElement('span', { className: 'text-yellow-500 text-4xl' }, gameState.lastAction.actualCount)
                        ),
                        React.createElement('div', { className: 'mt-4 text-sm text-slate-400 animate-pulse' }, 'NEXT ROUND STARTING AUTOMATICALLY...')
                    ),

                     // Winner Screen
                     gameState.phase === 'WON' && React.createElement('div', { className: 'text-center z-50' },
                        React.createElement('div', { className: 'text-8xl mb-4' }, 'ðŸ†'),
                        React.createElement('h1', { className: 'text-5xl font-black text-yellow-400 mb-2' }, gameState.players[gameState.winnerId].name),
                        React.createElement('div', { className: 'text-2xl text-white' }, 'IS THE MASTER OF DICE!'),
                        gameState.hostId === player.id && React.createElement('button', { onClick: startGame, className: 'mt-8 bg-white text-black px-6 py-3 rounded-full font-bold' }, 'NEW GAME')
                    )
                ),

                // Controls (Bottom)
                React.createElement('div', { className: 'mt-auto' },
                    
                    // My Controls
                    isMyTurn && !cupOpen && React.createElement('div', { className: 'bg-slate-900/90 p-4 rounded-t-3xl border-t border-yellow-500/50 shadow-[0_-5px_20px_rgba(0,0,0,0.5)] animation-slide-up' },
                        React.createElement('div', { className: 'flex justify-center items-center space-x-6 mb-4' },
                            React.createElement('div', { className: 'flex items-center space-x-2 bg-slate-800 rounded-full p-1' },
                                React.createElement('button', { onClick: () => setLocalBid(b => ({...b, quantity: Math.max(1, b.quantity-1)})), className: 'w-10 h-10 rounded-full bg-slate-700 text-xl font-bold' }, '-'),
                                React.createElement('span', { className: 'text-3xl font-bold w-8 text-center' }, localBid?.quantity || 1),
                                React.createElement('button', { onClick: () => setLocalBid(b => ({...b, quantity: b.quantity+1})), className: 'w-10 h-10 rounded-full bg-slate-700 text-xl font-bold' }, '+')
                            ),
                            React.createElement('div', { className: 'flex items-center space-x-2 bg-slate-800 rounded-full p-1' },
                                React.createElement('button', { onClick: () => setLocalBid(b => ({...b, value: b.value === 1 ? 6 : b.value-1})), className: 'w-10 h-10 rounded-full bg-slate-700 text-xl font-bold' }, '<'),
                                React.createElement(DiceIcon, { value: localBid?.value || 2, size: 40 }),
                                React.createElement('button', { onClick: () => setLocalBid(b => ({...b, value: b.value === 6 ? 1 : b.value+1})), className: 'w-10 h-10 rounded-full bg-slate-700 text-xl font-bold' }, '>')
                            )
                        ),
                        React.createElement('div', { className: 'flex space-x-3' },
                            gameState.currentBid && React.createElement('button', { onClick: callDudo, className: 'flex-1 bg-gradient-to-br from-red-600 to-red-800 py-4 rounded-2xl font-black text-xl shadow-lg border-b-4 border-red-900 active:border-b-0 active:translate-y-1 transition' }, 'DUDO!'),
                            React.createElement('button', { onClick: placeBid, className: 'flex-[2] bg-gradient-to-br from-green-500 to-green-700 py-4 rounded-2xl font-black text-xl shadow-lg border-b-4 border-green-900 active:border-b-0 active:translate-y-1 transition' }, 'BET')
                        )
                    ),

                    // My Dice (Cup)
                    gameState.phase !== 'LOBBY' && me?.diceCount > 0 && React.createElement('div', { className: 'relative h-24 flex justify-center items-end pb-2' },
                        cupOpen 
                        ? React.createElement('div', { className: 'absolute bottom-20 bg-slate-800/90 p-4 rounded-2xl border-2 border-yellow-500 shadow-2xl flex gap-2 animate-bounce cursor-pointer', onClick: () => setCupOpen(false) },
                            me.dice.map((d, i) => React.createElement(DiceIcon, { key: i, value: d, size: 45 }))
                          )
                        : null,
                        
                        React.createElement('button', { 
                            onClick: () => { 
                                playSound('click');
                                setCupOpen(!cupOpen); 
                            }, 
                            className: `relative transition-transform active:scale-95 ${shaking ? 'shake-element' : ''}` 
                        },
                            React.createElement('div', { className: 'text-6xl filter drop-shadow-lg' }, 'ðŸ¥¤'),
                            !cupOpen && React.createElement('div', { className: 'absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold border-2 border-black' }, me.diceCount)
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
